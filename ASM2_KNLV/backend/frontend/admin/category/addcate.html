<link rel="stylesheet" href="../css/add.css">
<div class="modal-container">
    <form id="formCate">
        <h4>Thêm danh mục</h4>
        <label for="name">Tên danh mục</label>
        <input type="text" id="name" name="name" required />
        <label for="image">Hình ảnh</label>
        <input type="file" id="image" name="img" required />
        <button type="submit">Thêm danh mục</button>
        <a href="category.html">Trở lại</a>
    </form>
</div>

<script>
    document.getElementById('formCate').addEventListener('submit', async (e) => {
    e.preventDefault();

    // Lấy token từ localStorage
    const getToken = () => localStorage.getItem("token");

    // Kiểm tra quyền admin
    const isAdmin = () => localStorage.getItem("role") === "admin";

    if (!isAdmin()) {
        window.location.href = "../../index.html"; // Chuyển hướng về trang chủ
        alert("Bạn không có quyền truy cập!");
        return;
    }

    const form = e.target;
    const formData = new FormData(form);

    try {
        const token = getToken();

        const response = await fetch('http://localhost:3000/categories', {
            method: 'POST',
            body: formData,
            headers: {
                "Authorization": `Bearer ${token}` // Gửi token để xác thực
            }
        });

        if (!response.ok) {
            throw new Error(`Lỗi: ${response.status}`);
        }

        const data = await response.json();
        alert('Thêm danh mục thành công!');
        console.log('Thành công:', data);
        
        window.location.href = 'category.html';
    } catch (error) {
        alert('Có lỗi xảy ra: ' + error.message);
        console.error('Lỗi:', error);
    }
});

</script>
